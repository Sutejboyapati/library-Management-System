import{a as E}from"./chunk-RTNBUYP5.js";import{a as I}from"./chunk-N7XR7CD3.js";import{a as B}from"./chunk-CDMB5YBM.js";import{A as b,B as k,F as g,I as x,J as h,K as d,N as n,O as i,Q as f,R as C,S as l,T as a,U as c,V as p,oa as v,qa as S,ra as w,s as _,t as u,y as o}from"./chunk-OW66QSYT.js";function P(e,m){e&1&&(n(0,"p",2),a(1,"Loading..."),i())}function D(e,m){if(e&1&&(n(0,"dt"),a(1,"Genre"),i(),n(2,"dd"),a(3),i()),e&2){let t=l(2);o(3),c(t.book.genre)}}function y(e,m){if(e&1&&(n(0,"dt"),a(1,"Language"),i(),n(2,"dd"),a(3),i()),e&2){let t=l(2);o(3),c(t.book.language)}}function L(e,m){if(e&1&&(n(0,"dt"),a(1,"Shelf"),i(),n(2,"dd"),a(3),i()),e&2){let t=l(2);o(3),c(t.book.shelf_number)}}function T(e,m){if(e&1&&(n(0,"dt"),a(1,"ISBN"),i(),n(2,"dd"),a(3),i()),e&2){let t=l(2);o(3),c(t.book.isbn)}}function A(e,m){if(e&1&&(n(0,"p",7),a(1),i()),e&2){let t=l(2);h("error-message",t.message.startsWith("Failed")||t.message.includes("error")),o(),c(t.message)}}function j(e,m){if(e&1){let t=f();n(0,"button",8),C("click",function(){_(t);let s=l(2);return u(s.borrow())}),a(1),i()}if(e&2){let t=l(2);x("disabled",t.actionLoading),o(),p(" ",t.actionLoading?"Borrowing...":"Borrow this book"," ")}}function N(e,m){if(e&1&&(n(0,"h2"),a(1),i(),n(2,"p",3),a(3),i(),n(4,"dl",4)(5,"dt"),a(6,"Available copies"),i(),n(7,"dd"),a(8),i(),g(9,D,4,1)(10,y,4,1)(11,L,4,1)(12,T,4,1),i(),g(13,A,2,3,"p",5)(14,j,2,2,"button",6)),e&2){let t=l();o(),c(t.book.title),o(2),p("by ",t.book.author,""),o(5),c(t.book.available_copies),o(),d(t.book.genre?9:-1),o(),d(t.book.language?10:-1),o(),d(t.book.shelf_number?11:-1),o(),d(t.book.isbn?12:-1),o(),d(t.message?13:-1),o(),d(!t.isAdmin&&t.auth.isLoggedIn()&&t.available>0?14:-1)}}var q=(()=>{class e{constructor(t,r,s,M,O){this.route=t,this.router=r,this.bookService=s,this.borrowService=M,this.auth=O,this.book=null,this.loading=!0,this.actionLoading=!1,this.message="",this.isAdmin=!1,this.isAdmin=this.auth.isAdmin()}ngOnInit(){let t=this.route.snapshot.paramMap.get("id");if(!t){this.router.navigate(["/main/books"]);return}let r=Number(t);if(Number.isNaN(r)){this.router.navigate(["/main/books"]);return}this.loading=!0,this.bookService.getBook(r).subscribe({next:s=>this.book=s,error:()=>{this.book=null,this.router.navigate(["/main/books"])},complete:()=>this.loading=!1})}borrow(){!this.book||this.actionLoading||(this.message="",this.actionLoading=!0,this.borrowService.borrow(this.book.id).subscribe({next:()=>{this.message="Book borrowed successfully.",this.refreshBook()},error:t=>{this.message=t?.error??t?.message??"Failed to borrow."},complete:()=>this.actionLoading=!1}))}refreshBook(){this.book&&this.bookService.getBook(this.book.id).subscribe({next:t=>this.book=t})}get available(){return this.book?.available_copies??0}static{this.\u0275fac=function(r){return new(r||e)(b(v),b(S),b(E),b(I),b(B))}}static{this.\u0275cmp=k({type:e,selectors:[["app-book-detail"]],decls:5,vars:1,consts:[[1,"book-detail"],["routerLink","/main/books",1,"back-link"],[1,"loading"],[1,"author"],[1,"meta"],[1,"message",3,"error-message"],["type","button",1,"btn-borrow",3,"disabled"],[1,"message"],["type","button",1,"btn-borrow",3,"click","disabled"]],template:function(r,s){r&1&&(n(0,"div",0)(1,"a",1),a(2,"\u2190 Back to books"),i(),g(3,P,2,0,"p",2)(4,N,15,9),i()),r&2&&(o(3),d(s.loading?3:s.book?4:-1))},dependencies:[w],styles:[".back-link[_ngcontent-%COMP%]{display:inline-block;margin-bottom:1rem;font-size:.9rem;color:#0021a5}.book-detail[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 .35rem;font-size:1.5rem}.author[_ngcontent-%COMP%]{color:#555;margin-bottom:1.5rem}.meta[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 1fr;gap:.25rem 1.5rem;margin-bottom:1.5rem}.meta[_ngcontent-%COMP%]   dt[_ngcontent-%COMP%]{margin:0;color:#666;font-weight:500}.meta[_ngcontent-%COMP%]   dd[_ngcontent-%COMP%]{margin:0}.message[_ngcontent-%COMP%]{margin:1rem 0}.btn-borrow[_ngcontent-%COMP%]{padding:10px 20px;background:#ff4813;color:#fff;border:none;border-radius:8px;font-size:1rem;font-weight:500}.btn-borrow[_ngcontent-%COMP%]:hover:not(:disabled){background:#e63e0a}.btn-borrow[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed}.loading[_ngcontent-%COMP%]{color:#666}"]})}}return e})();export{q as BookDetailComponent};
