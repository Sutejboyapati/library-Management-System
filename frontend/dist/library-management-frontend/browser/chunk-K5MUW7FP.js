import{a as O}from"./chunk-N7XR7CD3.js";import"./chunk-CDMB5YBM.js";import{A as x,B as C,F as m,I as w,K as l,L as h,M as y,N as a,O as r,Q as v,R as M,S as c,T as d,U as p,V as g,W as B,aa as _,ba as u,ia as k,s as f,t as b,y as i}from"./chunk-OW66QSYT.js";function S(t,s){let e;return s.book_id+((e=s.borrowed_at)!==null&&e!==void 0?e:"")}function E(t,s){if(t&1&&(a(0,"p",1),d(1),r()),t&2){let e=c();i(),p(e.message)}}function T(t,s){t&1&&(a(0,"p",2),d(1,"Loading..."),r())}function I(t,s){t&1&&(a(0,"p",3),d(1,"You have no active borrowings."),r())}function D(t,s){if(t&1&&(a(0,"span",7),d(1),r()),t&2){let e=c().$implicit;i(),g(" \u2013 ",e.author,"")}}function L(t,s){if(t&1){let e=v();a(0,"li",5)(1,"div",6)(2,"strong"),d(3),r(),m(4,D,2,1,"span",7),a(5,"div",8),d(6),_(7,"date"),_(8,"date"),r()(),a(9,"button",9),M("click",function(){let o=f(e).$implicit,P=c(2);return b(P.returnBook(o))}),d(10),r()()}if(t&2){let e,n=s.$implicit,o=c(2);i(3),p((e=n.title)!==null&&e!==void 0?e:"Book #"+n.book_id),i(),l(n.author?4:-1),i(2),B(" Borrowed: ",u(7,6,n.borrowed_at,"mediumDate")," \xB7 Due: ",u(8,9,n.due_date,"mediumDate")," "),i(3),w("disabled",o.actionLoading===n.book_id),i(),g(" ",o.actionLoading===n.book_id?"Returning...":"Return"," ")}}function F(t,s){if(t&1&&(a(0,"ul",4),h(1,L,11,12,"li",5,S),r()),t&2){let e=c();i(),y(e.activeRecords())}}var $=(()=>{class t{constructor(e){this.borrowService=e,this.records=[],this.loading=!0,this.actionLoading=null,this.message=""}ngOnInit(){this.load()}load(){this.loading=!0,this.borrowService.getMyBorrowings().subscribe({next:e=>{this.records=Array.isArray(e)?e:[]},error:()=>{this.records=[]},complete:()=>this.loading=!1})}returnBook(e){let n=e.book_id;this.message="",this.actionLoading=n,this.borrowService.returnBook(n).subscribe({next:()=>{this.message="Book returned successfully.",this.load()},error:o=>{this.message=o?.error??o?.message??"Failed to return."},complete:()=>this.actionLoading=null})}activeRecords(){return this.records.filter(e=>e.status==="Borrowing"||!e.returned_at)}static{this.\u0275fac=function(n){return new(n||t)(x(O))}}static{this.\u0275cmp=C({type:t,selectors:[["app-my-borrowings"]],decls:7,vars:2,consts:[[1,"my-borrowings"],[1,"message"],[1,"loading"],[1,"empty"],[1,"borrow-list"],[1,"borrow-item"],[1,"borrow-info"],[1,"author"],[1,"dates"],["type","button",1,"btn-return",3,"click","disabled"]],template:function(n,o){n&1&&(a(0,"div",0)(1,"h2"),d(2,"My borrowings"),r(),m(3,E,2,1,"p",1)(4,T,2,0,"p",2)(5,I,2,0,"p",3)(6,F,3,0,"ul",4),r()),n&2&&(i(3),l(o.message?3:-1),i(),l(o.loading?4:o.activeRecords().length===0?5:6))},dependencies:[k],styles:[".my-borrowings[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 1rem;font-size:1.5rem}.borrow-list[_ngcontent-%COMP%]{list-style:none;margin:0;padding:0}.borrow-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px;padding:16px;margin-bottom:12px;background:#f8f9fa;border:1px solid #e9ecef;border-radius:8px}.borrow-info[_ngcontent-%COMP%]   .author[_ngcontent-%COMP%]{color:#555;font-weight:400}.dates[_ngcontent-%COMP%]{font-size:.875rem;color:#666;margin-top:.35rem}.btn-return[_ngcontent-%COMP%]{padding:8px 16px;background:#ff4813;color:#fff;border:none;border-radius:6px;font-size:.9rem}.btn-return[_ngcontent-%COMP%]:hover:not(:disabled){background:#e63e0a}.btn-return[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed}.loading[_ngcontent-%COMP%], .empty[_ngcontent-%COMP%]{color:#666;margin:1rem 0}.message[_ngcontent-%COMP%]{margin-bottom:1rem}"]})}}return t})();export{$ as MyBorrowingsComponent};
